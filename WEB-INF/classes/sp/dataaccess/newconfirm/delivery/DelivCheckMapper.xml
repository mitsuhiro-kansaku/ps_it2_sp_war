<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sp.dataaccess.newconfirm.delivery.DelivCheckMapper">
    <select id="downLoad" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition"
         resultType="fw.domain.sp.dlv.dlvconfirm.DelivDownloadItem">
         <include refid="pageHeader"/>
         SELECT
             S_NEW_DLV_EST.DPO_FLG AS "statusCd",
             S_NEW_DLV_EST.ORDER_NO AS "orderNo",
             S_ORDER.BUYER_COMPANY_CD AS "buyerCompanyCd",
             S_ORDER.BUYER_COMPANY_NAME AS "buyerCompanyName",
             S_ORDER.BUYER_SECTION_PLACE_CD AS "buyerSectionPlaceCd",
             S_ORDER.BUYER_SECTION_PLACE_NAME AS "buyerSectionPlaceName",
             S_ORDER.BUYER_SECTION_CD AS "buyerSectionCd",
             S_ORDER.BUYER_SECTION_NAME AS "buyerSectionName",
             S_ORDER.BUYER_USER_ID AS "buyerCustUserCd",
             S_ORDER.BUYER_USER_NAME AS "buyerCustUserName",
             S_ORDER.BUYER_USER_TEL_NO AS "contact",
             S_NEW_DLV_EST.INQ_COMMENT AS "appRemark",
             S_ORDER.ITEM_NAME AS "itemName",
             S_ORDER.CUST_ITEM_CD AS "itemCd",
             S_ORDER.KATASHIKI AS "katashiki",
             S_ORDER.MANUFACT_CD AS "manufactCd",
             S_ORDER.MANUFACT_NAME AS "manufactName",
             S_NEW_DLV_EST.DELIV_VERSION AS "delivCheckHistoryNo",
             S_NEW_DLV_EST.INQ_DATE AS "delivAppDate.dateOfymd",
             S_NEW_DLV_EST.RESP_LIMIT_DATE AS "delivRespLimit.dateOfymd",
             S_ORDER.ORDER_VOL AS "orderVol.vol",
             S_ORDER.UNIT_CD AS "unitCd",
             S_ORDER.UNIT_NAME AS "unitName",
             S_ORDER.CURRENCY_CD AS "currencyCd",
             S_ORDER.ORDER_AMOUNT AS "orderAmount.amount",
             S_ORDER.ORDER_FIRST_DATE AS "orderDate.dateOfymd",
             S_ORDER.DELIVERY_DATE AS "orderDeliv.dateOfymd",
             S_ORDER.ORDER_VERSION AS "historyNo",
             S_ORDER.TITLE_NAME AS "titleName",
             S_ORDER.CORRECT_CD,
             S_ORDER.REQ_TYPE_IND AS "reqIndCd",
             S_ORDER.UNIT_PRICE_IND AS "unitPriceIndCd",
             S_ORDER.FOR_SUPPLIER_COMMENT AS "custUserComment",
             S_ORDER.UNIT_PRICE AS "orderUnitPrice.amount",
             S_ORDER.ORDER_CANCEL_VOL AS "orderCancelVol.vol",
             S_ORDER.ORDER_CANCEL_AMOUNT AS "orderCancelAmount.amount",
             S_ORDER.TAX_IND AS "taxIndCd",
             S_ORDER.DELIV_PLACE_ZIP_CD AS "delivPlaceZipCd",
             S_ORDER.DELIV_PLACE_NAME AS "delivPlaceName",
             S_ORDER.DELIV_PLACE_ADDRESS1 AS "delivPlaceAddress1",
             S_ORDER.DELIV_PLACE_ADDRESS2 AS "delivPlaceAddress2",
             S_ORDER.DELIV_PLACE_TEL_NO AS "delivPlaceTel",
             S_ORDER.DEST_AREA AS "delivPlaceLocation",
             S_ORDER_ATTACH_A.ATTACH_FILE_NAME AS "attachFileName1",
             S_ORDER_ATTACH_B.ATTACH_FILE_NAME AS "attachFileName2",
             S_ORDER_ATTACH_C.ATTACH_FILE_NAME AS "attachFileName3",
             S_NEW_DLV_EST_DTL.EST_DELIV_DATE AS "appDelivDate.dateOfymd",
             S_NEW_DLV_EST_DTL.EST_DELIV_VOL AS "appVol.vol"
        FROM S_NEW_DLV_EST
        INNER JOIN(
            SELECT M_SUPPLIER.COMPANY_CD,
                   M_SUPPLIER.SUP_CD
            FROM M_SUPPLIER
            WHERE M_SUPPLIER.VENDOR_CD = '${@sp.common.util.SecurityUtil@getVendorCdByEscapeSql()}'
                <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    AND M_SUPPLIER.COMPANY_CD = 'ALL'
                </if>
                <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    <if test="@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN
                        <foreach collection="@sp.common.util.SecurityUtil@getBuyerCompanyCdList()" item="custCdList" open="(" separator="," close=")">
                            #{custCdList}
                        </foreach>
                    </if>
                    <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN ('${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}')
                    </if>
                </if>
                AND M_SUPPLIER.TERM_FLG = '0'
                AND M_SUPPLIER.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
                AND M_SUPPLIER.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
            ) M_SUPPLIER_V
        ON S_NEW_DLV_EST.ACC_CD = M_SUPPLIER_V.SUP_CD
        <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            AND S_NEW_DLV_EST.CUST_CD = M_SUPPLIER_V.COMPANY_CD
        </if>
        <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                AND S_NEW_DLV_EST.CUST_CD = '${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}'
            </if>
        </if>

        INNER JOIN  (
               S_ORDER INNER　JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE
                         S_ORDER_B.DELETE_FLG = '0'
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION
        )
             ON  S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
                AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
                AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_A
            ON   S_ORDER.ATTACH_FILE_SEQ1 = S_ORDER_ATTACH_A.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_A.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_B
            ON   S_ORDER.ATTACH_FILE_SEQ2 = S_ORDER_ATTACH_B.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_B.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_C
            ON   S_ORDER.ATTACH_FILE_SEQ3 = S_ORDER_ATTACH_C.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_C.DELETE_FLG = '0'
        LEFT JOIN S_NEW_DLV_EST_DTL
            ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
                 AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
                 AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
                 AND  S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
        <where>
            S_NEW_DLV_EST.DELETE_FLG = '0'
            <if test="searchObject.searchObject!=9">
                AND S_NEW_DLV_EST.DPO_FLG = #{searchObject.searchObject}
            </if>
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderNo)">
                AND S_NEW_DLV_EST.ORDER_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition","orderNo")}
            </if>
            <if
                test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateFrom.dateOfymd)">
                AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE >= #{delivCheckDateFrom.dateOfymd}
            </if>
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateTo.dateOfymd)">
                AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE &lt;= #{delivCheckDateTo.dateOfymd}
            </if>
        </where>
        ORDER BY ${searchCondition.columnOrder.defaultOrder}
        <include refid="pageRoot"/>
    </select>
    <select id="downloadCount" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition"
         resultType="java.lang.Long">
         SELECT
             COUNT(*)
        FROM S_NEW_DLV_EST
        INNER JOIN(
            SELECT M_SUPPLIER.COMPANY_CD,
                   M_SUPPLIER.SUP_CD
            FROM M_SUPPLIER
            WHERE M_SUPPLIER.VENDOR_CD = '${@sp.common.util.SecurityUtil@getVendorCdByEscapeSql()}'
                <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    AND M_SUPPLIER.COMPANY_CD = 'ALL'
                </if>
                <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    <if test="@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN
                        <foreach collection="@sp.common.util.SecurityUtil@getBuyerCompanyCdList()" item="custCdList" open="(" separator="," close=")">
                            #{custCdList}
                        </foreach>
                    </if>
                    <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN ('${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}')
                    </if>
                </if>
                AND M_SUPPLIER.TERM_FLG = '0'
                AND M_SUPPLIER.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
                AND M_SUPPLIER.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
            ) M_SUPPLIER_V
        ON S_NEW_DLV_EST.ACC_CD = M_SUPPLIER_V.SUP_CD
        <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            AND S_NEW_DLV_EST.CUST_CD = M_SUPPLIER_V.COMPANY_CD
        </if>
        <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                AND S_NEW_DLV_EST.CUST_CD = '${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}'
            </if>
        </if>

        INNER JOIN  (
               S_ORDER INNER　JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE
                         S_ORDER_B.DELETE_FLG = '0'
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION
        )
             ON  S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
                AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
                AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_A
            ON   S_ORDER.ATTACH_FILE_SEQ1 = S_ORDER_ATTACH_A.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_A.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_B
            ON   S_ORDER.ATTACH_FILE_SEQ2 = S_ORDER_ATTACH_B.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_B.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_C
            ON   S_ORDER.ATTACH_FILE_SEQ3 = S_ORDER_ATTACH_C.ATTACH_FILE_SEQ
                AND S_ORDER_ATTACH_C.DELETE_FLG = '0'
        LEFT JOIN S_NEW_DLV_EST_DTL
            ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
                 AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
                 AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
                 AND  S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
        <where>
            S_NEW_DLV_EST.DELETE_FLG = '0'
            <if test="searchObject.searchObject!=9">
                AND S_NEW_DLV_EST.DPO_FLG = #{searchObject.searchObject}
            </if>
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderNo)">
                AND S_NEW_DLV_EST.ORDER_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition","orderNo")}
            </if>
            <if
                test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateFrom.dateOfymd)">
                AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE >= #{delivCheckDateFrom.dateOfymd}
            </if>
            <if test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateTo.dateOfymd)">
                AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE &lt;= #{delivCheckDateTo.dateOfymd}
            </if>
        </where>
    </select>

    <sql id="listKeyIdentityWhereCondition">
        AND S_NEW_DLV_EST.DELETE_FLG='0'
        <if test="searchObject.searchObject!=9">
            AND S_NEW_DLV_EST.DPO_FLG = #{searchObject.searchObject}
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(orderNo)">
            AND S_NEW_DLV_EST.ORDER_NO ${@fw.common.util.SearchModeUtil@getSearchSQL("fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition","orderNo")}
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateFrom.dateOfymd)">
            AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE >= #{delivCheckDateFrom.dateOfymd}
        </if>
        <if test="@org.apache.commons.lang.StringUtils@isNotBlank(delivCheckDateTo.dateOfymd)">
            AND S_NEW_DLV_EST_DTL.EST_DELIV_DATE &lt;= #{delivCheckDateTo.dateOfymd}
        </if>
    </sql>

    <!-- 検索」ボタンクリック時、検索条件で一覧キーリストを取得する-->
    <select id="listKeyIdentity" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckSearchCondition"
        resultType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify">
        SELECT
            S_NEW_DLV_EST.DLV_EST_SEQ AS "delivMngSeq",
            S_NEW_DLV_EST.ORDER_NO AS "orderNo",
            S_NEW_DLV_EST.DELIV_VERSION
        FROM
            S_NEW_DLV_EST
        INNER JOIN(
            SELECT M_SUPPLIER.COMPANY_CD,
                   M_SUPPLIER.SUP_CD
            FROM M_SUPPLIER
            WHERE M_SUPPLIER.VENDOR_CD = '${@sp.common.util.SecurityUtil@getVendorCdByEscapeSql()}'
                <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    AND M_SUPPLIER.COMPANY_CD = 'ALL'
                </if>
                <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    <if test="@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN
                        <foreach collection="@sp.common.util.SecurityUtil@getBuyerCompanyCdList()" item="custCdList" open="(" separator="," close=")">
                            #{custCdList}
                        </foreach>
                    </if>
                    <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN ('${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}')
                    </if>
                </if>
                AND M_SUPPLIER.TERM_FLG = '0'
                AND M_SUPPLIER.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
                AND M_SUPPLIER.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
            ) M_SUPPLIER_V
        ON S_NEW_DLV_EST.ACC_CD = M_SUPPLIER_V.SUP_CD
            <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            AND S_NEW_DLV_EST.CUST_CD = M_SUPPLIER_V.COMPANY_CD
            </if>
            <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                AND S_NEW_DLV_EST.CUST_CD = '${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}'
            </if>
            </if>
        LEFT JOIN  S_NEW_DLV_EST_DTL
            ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
            AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
            AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
            AND  S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
        INNER JOIN  (
               S_ORDER INNER　JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE S_ORDER_B.DELETE_FLG = '0'
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION

        )
        ON   S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
        AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
        AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
        <where>
            <include refid="listKeyIdentityWhereCondition"/>
         </where>
         GROUP BY
            S_NEW_DLV_EST.DLV_EST_SEQ,
            S_NEW_DLV_EST.ACC_CD,
            S_NEW_DLV_EST.CUST_CD,
            S_NEW_DLV_EST.DELIV_VERSION,
            S_NEW_DLV_EST.DPO_FLG,
            S_NEW_DLV_EST.ORDER_NO,
            S_ORDER.BUYER_COMPANY_NAME,
            S_ORDER.FOR_SUPPLIER_COMMENT,
            S_ORDER.ITEM_NAME,
            S_ORDER.CUST_ITEM_CD,
            S_ORDER.KATASHIKI,
            S_NEW_DLV_EST.INQ_DATE,
            S_NEW_DLV_EST.RESP_LIMIT_DATE,
            S_ORDER.ORDER_VOL,
            S_ORDER.UNIT_NAME,
            S_ORDER.CURRENCY_CD,
            S_ORDER.UNIT_PRICE_IND,
            S_ORDER.ORDER_AMOUNT,
            S_NEW_DLV_EST.LAST_UPD_DATE,
            S_ORDER.LAST_UPD_DATE
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>

    <resultMap id="DelivCheckListItem_Map" type="fw.domain.sp.dlv.dlvconfirm.DelivCheckListItem">
        <id column="EXCLUSIVE_SLIP_NO" property="delivMngIdentify.exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="delivMngIdentify.exclusiveSlipId.lastUpdDate"/>
    </resultMap>
    <select id="listPageItem"
        resultMap="DelivCheckListItem_Map">

        SELECT
            S_NEW_DLV_EST.DLV_EST_SEQ AS "delivMngIdentify.delivMngSeq",
            S_NEW_DLV_EST.ACC_CD AS "delivMngIdentify.accCd",
            S_NEW_DLV_EST.CUST_CD AS "delivMngIdentify.custCd",
            S_NEW_DLV_EST.DELIV_VERSION AS "revisionNumber",
            S_NEW_DLV_EST.DPO_FLG AS "status",
            S_NEW_DLV_EST.ORDER_NO AS "orderNo",
            S_ORDER.BUYER_COMPANY_CD AS "buyerCompanyCd",
            S_ORDER.BUYER_COMPANY_NAME AS "buyerCompany",
            S_ORDER.FOR_SUPPLIER_COMMENT AS "buyerCompanyComment",
            S_ORDER.ITEM_NAME AS "itemName",
            S_ORDER.CUST_ITEM_CD AS "itemCd",
            S_ORDER.KATASHIKI AS "katashiki",
            S_NEW_DLV_EST.INQ_DATE AS "delivCheckDate.dateOfymd",
            S_NEW_DLV_EST.RESP_LIMIT_DATE AS "respLimitDate.dateOfymd",
            S_ORDER.ORDER_VOL AS "orderVol.vol",
            S_ORDER.UNIT_NAME AS "orderUnit",
            S_ORDER.CURRENCY_CD AS "currencyCd",
            S_ORDER.UNIT_PRICE_IND AS "unitPriceInd" ,
            S_ORDER.ORDER_AMOUNT AS "orderAmount.amount",
            S_ORDER.ORDER_CANCEL_VOL AS "orderCancelVol.vol",
            S_ORDER.ORDER_CANCEL_AMOUNT AS "orderCancelAmount.amount",
            (S_ORDER.ATTACH_FILE_SEQ1 || S_ORDER.ATTACH_FILE_SEQ2 || S_ORDER.ATTACH_FILE_SEQ3) as "attachFlg",
            S_NEW_DLV_EST.LAST_UPD_DATE AS "delivMngIdentify.lastUpdDate",
            S_ORDER.LAST_UPD_DATE
            ,S_SLIP.SLIP_NO AS EXCLUSIVE_SLIP_NO
            ,S_SLIP.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE
        FROM
            S_NEW_DLV_EST
        INNER JOIN(
            SELECT M_SUPPLIER.COMPANY_CD,
                   M_SUPPLIER.SUP_CD
            FROM M_SUPPLIER
            WHERE M_SUPPLIER.VENDOR_CD = '${@sp.common.util.SecurityUtil@getVendorCdByEscapeSql()}'
                <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    AND M_SUPPLIER.COMPANY_CD = 'ALL'
                </if>
                <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    <if test="@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN
                        <foreach collection="@sp.common.util.SecurityUtil@getBuyerCompanyCdList()" item="custCdList" open="(" separator="," close=")">
                            #{custCdList}
                        </foreach>
                    </if>
                    <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN ('${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}')
                    </if>
                </if>
                AND M_SUPPLIER.TERM_FLG = '0'
                AND M_SUPPLIER.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
                AND M_SUPPLIER.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
            ) M_SUPPLIER_V
        ON S_NEW_DLV_EST.ACC_CD = M_SUPPLIER_V.SUP_CD
            <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            AND S_NEW_DLV_EST.CUST_CD = M_SUPPLIER_V.COMPANY_CD
            </if>
            <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                AND S_NEW_DLV_EST.CUST_CD = '${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}'
            </if>
            </if>
        LEFT JOIN  S_NEW_DLV_EST_DTL
            ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
            AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
            AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
            AND  S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
        INNER JOIN  (
               S_ORDER INNER　JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION

        )
        ON   S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
        AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
        AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO

        INNER JOIN S_SLIP ON S_SLIP.SLIP_NO = S_NEW_DLV_EST.ORDER_NO

        <where>
            S_NEW_DLV_EST.DLV_EST_SEQ IN
            <foreach collection="searchCondition.page.keyDomainEntityList" item="keyList"
                open="(" separator="," close=")">
                #{keyList.delivMngSeq}
            </foreach>
            <include refid="listKeyIdentityWhereCondition"/>
        </where>
        GROUP BY
            S_NEW_DLV_EST.DLV_EST_SEQ,
            S_NEW_DLV_EST.ACC_CD,
            S_NEW_DLV_EST.CUST_CD,
            S_NEW_DLV_EST.DELIV_VERSION,
            S_NEW_DLV_EST.DPO_FLG,
            S_NEW_DLV_EST.ORDER_NO,
            S_ORDER.BUYER_COMPANY_CD,
            S_ORDER.BUYER_COMPANY_NAME,
            S_ORDER.FOR_SUPPLIER_COMMENT,
            S_ORDER.ITEM_NAME,
            S_ORDER.CUST_ITEM_CD,
            S_ORDER.KATASHIKI,
            S_NEW_DLV_EST.INQ_DATE,
            S_NEW_DLV_EST.RESP_LIMIT_DATE,
            S_ORDER.ORDER_VOL,
            S_ORDER.ORDER_CANCEL_VOL,
            S_ORDER.ORDER_CANCEL_AMOUNT,
            S_ORDER.UNIT_NAME,
            S_ORDER.CURRENCY_CD,
            S_ORDER.UNIT_PRICE_IND,
            S_ORDER.ORDER_AMOUNT,
            S_NEW_DLV_EST.LAST_UPD_DATE,
            S_ORDER.LAST_UPD_DATE,
            S_ORDER.ATTACH_FILE_SEQ1,
            S_ORDER.ATTACH_FILE_SEQ2,
            S_ORDER.ATTACH_FILE_SEQ3
            ,S_SLIP.SLIP_NO
            ,S_SLIP.LAST_UPD_DATE
        ORDER BY ${searchCondition.columnOrder.columnOrder()}
    </select>
    <!-- 新着納期キーリストで、該当ページの確認納期項目リストを取得-->
    <select id="listCheckDelivDate" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckListItem"
    resultType="fw.domain.sp.dlv.dlvconfirm.CheckDelivDate">
        SELECT
            S_NEW_DLV_EST_DTL.EST_DELIV_DATE AS "checkDelivDate.dateOfymd"
        FROM
            S_NEW_DLV_EST
        LEFT JOIN
            S_NEW_DLV_EST_DTL
            ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
            AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
            AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
            AND  S_NEW_DLV_EST.DELIV_VERSION=S_NEW_DLV_EST_DTL.DELIV_VERSION
        WHERE
            S_NEW_DLV_EST.DLV_EST_SEQ =#{delivMngIdentify.delivMngSeq}
        ORDER BY S_NEW_DLV_EST_DTL.EST_DELIV_DATE
    </select>

    <!-- 「新着確認」ボタンクリック時、SQL仕様-->
    <update id="update" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckNewInfo">
      UPDATE S_NEW_DLV_EST SET
        DPO_FLG = '1'
      , LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
      , LAST_UPD_USER_ID='${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
       WHERE DLV_EST_SEQ IN
        <foreach collection="delivMngSeqList" item="delivMngIdentify" open="(" separator="," close=")">
             #{delivMngIdentify.delivMngSeq}
        </foreach>
    </update>

    <insert id="insert">
      INSERT INTO S_DLV_EST_MNG (
        ACC_CD
      , CUST_CD
      , ORDER_NO
      , ORDER_VERSION
      , DELIV_VERSION
      , INQ_RESP_IND
      , DLV_EST_MNG_SEQ
      , INFO_IND
      , INQ_RESP_DATE
      , RESP_LIMIT_DATE
      , INQ_RESP_COMMENT
      , CONFIRM_MARK
      , SEND_IND
      , RECEIPT_NUMBER
      , DELETE_FLG
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_USER_ID
      ) SELECT ACC_CD
             , CUST_CD
             , ORDER_NO
             , ORDER_VERSION
             , DELIV_VERSION
             , '1'
             , #{dlvEstSeq}
             , '0701'
             , INQ_DATE
             , RESP_LIMIT_DATE
             , INQ_COMMENT
             , NULL
             , '9'
             , NULL
             , DELETE_FLG
             , AUTO_DELETE_FLG
             , AUTO_DELETE_DATE
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
          FROM S_NEW_DLV_EST
         WHERE DLV_EST_SEQ IN
        <foreach collection="delivMngSeqList" item="delivMngIdentify" open="(" separator="," close=")">
               #{delivMngIdentify.delivMngSeq}
        </foreach>
    </insert>

    <insert id="insertItem" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckNewInfo">
      INSERT INTO S_DLV_EST_DTL (
        ACC_CD
      , CUST_CD
      , ORDER_NO
      , DELIV_VERSION
      , INQ_RESP_IND
      , DELIV_LINE_NO
      , INQ_RESP_DATE
      , INQ_RESP_VOL
      , CONFIRM_MARK
      , DELETE_FLG
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_USER_ID
      ) SELECT S_NEW_DLV_EST_DTL.ACC_CD
             , S_NEW_DLV_EST_DTL.CUST_CD
             , S_NEW_DLV_EST_DTL.ORDER_NO
             , S_NEW_DLV_EST_DTL.DELIV_VERSION
             , '1'
             , S_NEW_DLV_EST_DTL.DELIV_LINE_NO
             , S_NEW_DLV_EST_DTL.EST_DELIV_DATE
             , S_NEW_DLV_EST_DTL.EST_DELIV_VOL
             , NULL
             , S_NEW_DLV_EST_DTL.DELETE_FLG
             , S_NEW_DLV_EST_DTL.AUTO_DELETE_FLG
             , S_NEW_DLV_EST_DTL.AUTO_DELETE_DATE
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
          FROM S_NEW_DLV_EST_DTL,S_NEW_DLV_EST
         WHERE S_NEW_DLV_EST.DLV_EST_SEQ IN
        <foreach collection="delivMngSeqList" item="delivMngIdentify" open="(" separator="," close=")">
               #{delivMngIdentify.delivMngSeq}
        </foreach>
           AND S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
           AND S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
           AND S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
           AND S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
    </insert>

    <!-- 前回受注レコード（同一注文番号で、注文版数が最大の受注レコード）情報を取得 -->
        <select id="listOrderBaseInfo" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckNewInfo"
        resultType="fw.domain.sp.dlv.DelivDetail">
        SELECT
            S_ORDER.ACC_CD AS "delivRespIdentify.orderUserCd",
            S_ORDER.CUST_CD AS "delivRespIdentify.buyerUserCd",
            S_ORDER.ORDER_NO AS "delivRespIdentify.orderNo",
            S_ORDER.ORDER_VERSION AS "delivRespIdentify.delivVersion",
            S_ORDER.ORDER_STATUS AS "delivRespIdentify.inqRespInd"
        FROM
            S_NEW_DLV_EST
        INNER JOIN  (
               S_ORDER INNER JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE
                         S_ORDER_B.DELETE_FLG='0'
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION

        )
        ON   S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
        AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
        AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
        WHERE
            S_NEW_DLV_EST.DLV_EST_SEQ IN
            <foreach collection="delivMngSeqList" item="delivMngIdentify"
                open="(" separator="," close=")">
                #{delivMngIdentify.delivMngSeq}
            </foreach>
    </select>
    <!-- SQL（３）④で取得した受注ステータスが未回答OR回答済の場合、未回答に更新
    -->
    <update id="updateStatus" parameterType="fw.domain.sp.dlv.DelivDetail">
        UPDATE S_ORDER
        SET
          S_ORDER.ORDER_STATUS = '01',
          S_ORDER.LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
          S_ORDER.LAST_UPD_USER_ID='${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
          S_ORDER.ACC_CD = #{delivRespIdentify.orderUserCd}
          AND  S_ORDER.CUST_CD = #{delivRespIdentify.buyerUserCd}
          AND  S_ORDER.ORDER_NO = #{delivRespIdentify.orderNo}
          AND  S_ORDER.ORDER_VERSION = #{delivRespIdentify.delivVersion}
    </update>
    <!-- 「新着全件確認」ボタンクリック時、SQL仕様
        新着全件確認キーリストを取得
    -->
    <select id="listDelivCheckAllKey" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckAllDop"
        resultType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify">
        SELECT
            S_NEW_DLV_EST.DLV_EST_SEQ AS "delivMngSeq",
            S_NEW_DLV_EST.LAST_UPD_DATE AS "lastUpdDate",
            S_SLIP.SLIP_NO AS "orderNo"
        FROM
            S_NEW_DLV_EST
                INNER JOIN(
            SELECT M_SUPPLIER.COMPANY_CD,
                   M_SUPPLIER.SUP_CD
            FROM M_SUPPLIER
            WHERE M_SUPPLIER.VENDOR_CD = '${@sp.common.util.SecurityUtil@getVendorCdByEscapeSql()}'
                <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    AND M_SUPPLIER.COMPANY_CD = 'ALL'
                </if>
                <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
                    <if test="@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN
                        <foreach collection="@sp.common.util.SecurityUtil@getBuyerCompanyCdList()" item="custCdList" open="(" separator="," close=")">
                            #{custCdList}
                        </foreach>
                    </if>
                    <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                          AND M_SUPPLIER.COMPANY_CD IN ('${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}')
                    </if>
                </if>
                AND M_SUPPLIER.TERM_FLG = '0'
                AND M_SUPPLIER.VALID_START_DATE &lt;= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
                AND M_SUPPLIER.VALID_END_DATE >= '${@fw.common.util.AppUtil@getSysDate(@fw.common.util.AppUtil@DATE_SHORT)}'
            ) M_SUPPLIER_V
            ON S_NEW_DLV_EST.ACC_CD = M_SUPPLIER_V.SUP_CD
        <if test="!@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            AND S_NEW_DLV_EST.CUST_CD = M_SUPPLIER_V.COMPANY_CD
        </if>
        <if test="@fw.common.util.AppUtil@isUseAll(@fw.common.constant.ApplicationConstant@M_SUPPLIER_ALL_IND)">
            <if test="!@sp.common.util.SecurityUtil@isAllCust()">
                AND S_NEW_DLV_EST.CUST_CD = '${@sp.common.util.SecurityUtil@getCurrentBuyerCompanyCdByEscapeSql()}'
            </if>
        </if>
       INNER JOIN S_SLIP
       ON S_SLIP.SLIP_NO = S_NEW_DLV_EST.ORDER_NO
       WHERE
           S_NEW_DLV_EST.DPO_FLG = '0'
           AND S_NEW_DLV_EST.DELETE_FLG = '0'
            AND EXISTS (
                SELECT
                    S_ORDER.ACC_CD,
                    S_ORDER.CUST_CD,
                    S_ORDER.ORDER_NO
                FROM
                    S_ORDER S_ORDER
                WHERE
                    S_ORDER.DELETE_FLG = '0'
                    AND S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
                    AND S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
                    AND S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
                GROUP BY
                    S_ORDER.ACC_CD,
                    S_ORDER.CUST_CD,
                    S_ORDER.ORDER_NO
            )
       ORDER BY S_NEW_DLV_EST.ACC_CD, 
                S_NEW_DLV_EST.CUST_CD, 
                S_NEW_DLV_EST.ORDER_NO, 
                S_NEW_DLV_EST.DELIV_VERSION
       FOR UPDATE OF S_SLIP.SLIP_NO
    </select>
    <!-- 新着納期管理を更新 -->
    <update id="updateAll">
        UPDATE S_NEW_DLV_EST
        SET
            DPO_FLG = '1',
            LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_USER_ID = '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
            DLV_EST_SEQ IN
            <foreach collection="delivMngIdentifyList" item="delivMngIdentify" open="("
                separator="," close=")">
                #{delivMngIdentify.delivMngSeq}
            </foreach>
    </update>
    <!-- 伝票テーブルを更新 -->
    <update id="updateSlipAll">
        UPDATE S_SLIP
        SET
            LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
            LAST_UPD_USER_ID = '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
            SLIP_NO IN
            <foreach collection="delivMngIdentifyList" item="delivMngIdentify" open="("
                separator="," close=")">
                #{delivMngIdentify.orderNo}
            </foreach>
    </update>
    <!-- ③新着全件確認納期管理を登録 -->
    <insert id="insertAll">
      INSERT INTO S_DLV_EST_MNG (
        ACC_CD
      , CUST_CD
      , ORDER_NO
      , ORDER_VERSION
      , DELIV_VERSION
      , INQ_RESP_IND
      , DLV_EST_MNG_SEQ
      , INFO_IND
      , INQ_RESP_DATE
      , RESP_LIMIT_DATE
      , INQ_RESP_COMMENT
      , CONFIRM_MARK
      , SEND_IND
      , RECEIPT_NUMBER
      , DELETE_FLG
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_USER_ID
      ) SELECT ACC_CD
             , CUST_CD
             , ORDER_NO
             , ORDER_VERSION
             , DELIV_VERSION
             , '1'
             , #{dlvEstSeq}
             , '0701'
             , INQ_DATE
             , RESP_LIMIT_DATE
             , INQ_COMMENT
             , NULL
             , '9'
             , NULL
             , DELETE_FLG
             , AUTO_DELETE_FLG
             , AUTO_DELETE_DATE
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
          FROM S_NEW_DLV_EST
         WHERE DLV_EST_SEQ = #{delivMngSeq}
    </insert>
    <!-- ④新着全件確認納期回答明細を登録-->
    <insert id="insertItemAll" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify">
      INSERT INTO S_DLV_EST_DTL (
        ACC_CD
      , CUST_CD
      , ORDER_NO
      , DELIV_VERSION
      , INQ_RESP_IND
      , DELIV_LINE_NO
      , INQ_RESP_DATE
      , INQ_RESP_VOL
      , CONFIRM_MARK
      , DELETE_FLG
      , AUTO_DELETE_FLG
      , AUTO_DELETE_DATE
      , LAST_UPD_DATE
      , LAST_UPD_USER_ID
      , REG_DATE
      , REG_USER_ID
      ) SELECT S_NEW_DLV_EST_DTL.ACC_CD
             , S_NEW_DLV_EST_DTL.CUST_CD
             , S_NEW_DLV_EST_DTL.ORDER_NO
             , S_NEW_DLV_EST_DTL.DELIV_VERSION
             , '1'
             , S_NEW_DLV_EST_DTL.DELIV_LINE_NO
             , S_NEW_DLV_EST_DTL.EST_DELIV_DATE
             , S_NEW_DLV_EST_DTL.EST_DELIV_VOL
             , NULL
             , S_NEW_DLV_EST_DTL.DELETE_FLG
             , S_NEW_DLV_EST_DTL.AUTO_DELETE_FLG
             , S_NEW_DLV_EST_DTL.AUTO_DELETE_DATE
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
             , '${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}'
             , '${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
          FROM S_NEW_DLV_EST_DTL,S_NEW_DLV_EST
         WHERE S_NEW_DLV_EST.DLV_EST_SEQ IN
        <foreach collection="delivMngIdentifyList" item="delivMngIdentify" open="(" separator="," close=")">
               #{delivMngIdentify.delivMngSeq}
        </foreach>
           AND S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
           AND S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
           AND S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
           AND S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
    </insert>
    <!-- ⑤新着全件確認
    前回受注レコード（同一注文番号で、注文版数が最大の受注レコード）情報を取得 -->
    <resultMap id="DelivDetail_Map" type="fw.domain.sp.dlv.DelivDetail">
        <id column="EXCLUSIVE_SLIP_NO" property="delivRespIdentify.exclusiveSlipId.slipNo"/>
        <id column="EXCLUSIVE_LAST_UPD_DATE" property="delivRespIdentify.exclusiveSlipId.lastUpdDate"/>
    </resultMap>
    <select id="listOrderBaseInfoAll" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivCheckNewInfo"
        resultMap="DelivDetail_Map">
        SELECT
            S_ORDER.ACC_CD AS "delivRespIdentify.orderUserCd",
            S_ORDER.CUST_CD AS "delivRespIdentify.buyerUserCd",
            S_ORDER.ORDER_NO AS "delivRespIdentify.orderNo",
            S_ORDER.ORDER_VERSION AS "delivRespIdentify.delivVersion",
            S_ORDER.ORDER_STATUS AS "delivRespIdentify.inqRespInd"
            ,S_SLIP.SLIP_NO AS EXCLUSIVE_SLIP_NO
            ,S_SLIP.LAST_UPD_DATE AS EXCLUSIVE_LAST_UPD_DATE
        FROM
            S_NEW_DLV_EST
        INNER JOIN  (
               S_ORDER INNER JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE S_ORDER_B.DELETE_FLG ='0'
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION

        )
        ON   S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
        AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
        AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO

        INNER JOIN S_SLIP ON S_SLIP.SLIP_NO = S_NEW_DLV_EST.ORDER_NO

        WHERE
             S_NEW_DLV_EST.DLV_EST_SEQ IN
            <foreach collection="delivMngIdentifyList" item="delivMngIdentify" open="("
                separator="," close=")">
                #{delivMngIdentify.delivMngSeq}
            </foreach>

    </select>
    <!--  ⑥新着全件確認
    SQL（４）⑤で取得した受注ステータスが未回答OR回答済の場合、未回答に更新
    the same with method updateStatus-->
    <update id="updateOrderBaseInfo" parameterType="fw.domain.sp.dlv.DelivDetail">
        UPDATE S_ORDER
        SET
          S_ORDER.ORDER_STATUS = '01',
          S_ORDER.LAST_UPD_DATE='${@fw.common.util.AppUtil@getSysDateYyyyMMddHHmmssSSS()}',
          S_ORDER.LAST_UPD_USER_ID='${@sp.common.util.SecurityUtil@getUserIdByEscapeSql()}'
        WHERE
          S_ORDER.ACC_CD = #{delivRespIdentify.orderUserCd}
          AND  S_ORDER.CUST_CD = #{delivRespIdentify.buyerUserCd}
          AND  S_ORDER.ORDER_NO = #{delivRespIdentify.orderNo}
          AND  S_ORDER.ORDER_VERSION = #{delivRespIdentify.delivVersion}
    </update>
    <!-- 「詳細」ボタンクリック時、納期確認詳細情報のヘッダ部を取得する -->
    <!-- ①　選択された納期管理シーケンス番号で、納期確認詳細情報のヘッダ部を取得
     -->
     <resultMap id="OrderBaseInfo_Map" type="fw.domain.sp.common.OrderBaseInfo">
        <id column="BUYER_SECTION_PLACE_NAME" property="custInfo.custUser.sectionPlaceName"/>
        <id column="BUYER_USER_TEL_NO" property="custInfo.custUser.contact.telNo.telNo"/>
        <id column="BUYER_USER_MAIL_ADDR" property="custInfo.custUser.contact.mailAddr.mail"/>
        <id column="REQ_USER_MAIL_ADDR" property="requestUser.mailAddr.mail"/>
        <id column="DELIV_PLACE_ZIP" property="delivPlace.contact.zipCd.zipCd"/>
        <id column="DELIV_PLACE_ADDRESS1" property="delivPlace.contact.address1.address"/>
        <id column="DELIV_PLACE_ADDRESS2" property="delivPlace.contact.address2.address"/>
        <id column="DELIV_PLACE_TEL_NO" property="delivPlace.contact.telNo.telNo"/>
    </resultMap>
    <select id="delivOrderBaseInfo" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify"
        resultMap="OrderBaseInfo_Map">
         SELECT
             S_ORDER.ACC_CD AS "accCd",
             S_ORDER.CUST_CD AS "custCd",
             S_ORDER.ORDER_NO AS "orderNo.orderNo",
             S_ORDER.ORDER_VERSION AS "historyNo.historyNo",
             S_ORDER.INFO_CD AS "infoCd",
             S_ORDER.TITLE_NAME AS "titleName.titleName",
             S_ORDER.REQ_TYPE_IND AS "reqInd.reqInd",
             S_ORDER.UNIT_PRICE_IND AS "unitPriceInd",
             M_SUPPLIER_LANG.SUP_ABBR_NAME AS "accAbbrName",
             S_ORDER.PRICE_UNDEC_REASON AS "priceUndecidedReason",
             S_ORDER.PRICE_DEC_DATE AS "priceDecideDate.dateOfymd",
             S_ORDER.ORDER_FIRST_DATE AS "orderInfo.orderDate.dateOfymd",
             S_ORDER.DELIVERY_DATE AS "orderDeliv.dateOfymd",
             S_ORDER.BUYER_COMPANY_CD AS "custInfo.custCompany.code",
             S_ORDER.BUYER_COMPANY_NAME AS "custInfo.custCompany.name",
             S_ORDER.BUYER_SECTION_PLACE_NAME AS "BUYER_SECTION_PLACE_NAME",
             S_ORDER.BUYER_SECTION_NAME AS "custInfo.custUser.sectionName",
             S_ORDER.BUYER_USER_TEL_NO AS "BUYER_USER_TEL_NO",
             S_ORDER.BUYER_USER_MAIL_ADDR,
             S_ORDER.BUYER_USER_NAME AS "custInfo.custUser.userName",
             S_ORDER.FOR_SUPPLIER_COMMENT AS "custInfo.comment.comment",
             S_ORDER.REQ_SECTION_PLACE_NAME AS "requestUser.sectionPlaceName",
             S_ORDER.REQ_SECTION_NAME AS "requestUser.sectionName",
             S_ORDER.REQ_USER_NAME AS "requestUser.userName",
             S_ORDER.REQ_TEL_NO AS "requestUser.telNo.telNo",
             S_ORDER.REQ_USER_MAIL_ADDR,
             S_ORDER.ITEM_NAME  AS "itemName",
             S_ORDER.CUST_ITEM_CD AS "itemCd",
             S_ORDER.KATASHIKI AS "katashiki",
             S_ORDER.MANUFACT_CD AS "manufact.manufactCd",
             S_ORDER.MANUFACT_NAME AS "manufact.manufactName",
             S_ORDER.CURRENCY_CD AS "currencyCd",
             S_ORDER.UNIT_PRICE AS "orderInfo.orderPrice.amount",
             S_ORDER.ORDER_VOL AS "orderInfo.orderVol.vol",
             S_ORDER.REMAINING_VOL AS "orderInfo.remainingVol.vol",
             S_ORDER.ORDER_CANCEL_VOL AS "orderCancelVol.vol",
             S_ORDER.ORDER_AMOUNT AS "orderInfo.orderAmount.amount",
             S_ORDER.ORDER_CANCEL_AMOUNT AS "orderCancelAmount.amount",
             S_ORDER.TAX_IND AS "orderInfo.taxInd",
             S_ORDER.UNIT_NAME AS "orderInfo.unitName",
             S_ORDER.DELIV_PLACE_ZIP_CD AS "DELIV_PLACE_ZIP",
             S_ORDER.DELIV_PLACE_NAME AS "delivPlace.delivPlaceName",
             S_ORDER.DELIV_PLACE_ADDRESS1 AS "DELIV_PLACE_ADDRESS1",
             S_ORDER.DELIV_PLACE_ADDRESS2 AS "DELIV_PLACE_ADDRESS2",
             S_ORDER.DELIV_PLACE_TEL_NO AS "DELIV_PLACE_TEL_NO",
             S_ORDER.DEST_AREA AS "delivPlace.delivPlaceNameInb",
             S_ORDER.ATTACH_FILE_SEQ1 AS "attachFileSeq1",
             S_ORDER.ATTACH_FILE_SEQ2 AS "attachFileSeq2",
             S_ORDER.ATTACH_FILE_SEQ3 AS "attachFileSeq3",
             S_ORDER_ATTACH_A.ATTACH_FILE_NAME AS "attachFileName1",
             S_ORDER_ATTACH_B.ATTACH_FILE_NAME AS "attachFileName2",
             S_ORDER_ATTACH_C.ATTACH_FILE_NAME AS "attachFileName3"
        FROM S_NEW_DLV_EST
        INNER JOIN  (
               S_ORDER INNER　JOIN (
                     SELECT
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO,
                         MAX(S_ORDER_B.ORDER_VERSION) MAX_ORDER_VERSION
                     FROM
                         S_ORDER S_ORDER_B
                     WHERE
                         S_ORDER_B.DELETE_FLG = '0'
                         AND S_ORDER_B.INFO_CD IN ('0502','0503')
                     GROUP BY
                         S_ORDER_B.ACC_CD,
                         S_ORDER_B.CUST_CD,
                         S_ORDER_B.ORDER_NO

               )S_ORDER_V
               ON   S_ORDER.ACC_CD = S_ORDER_V.ACC_CD
               AND  S_ORDER.CUST_CD = S_ORDER_V.CUST_CD
               AND  S_ORDER.ORDER_NO = S_ORDER_V.ORDER_NO
               AND  S_ORDER.ORDER_VERSION=S_ORDER_V.MAX_ORDER_VERSION

        )
        ON   S_NEW_DLV_EST.ACC_CD = S_ORDER.ACC_CD
        AND  S_NEW_DLV_EST.CUST_CD = S_ORDER.CUST_CD
        AND  S_NEW_DLV_EST.ORDER_NO = S_ORDER.ORDER_NO
        AND  S_ORDER.DELETE_FLG = '0'
        INNER JOIN M_SUPPLIER
        ON
                (M_SUPPLIER.COMPANY_CD = S_ORDER.CUST_CD OR M_SUPPLIER.COMPANY_CD = 'ALL')
            AND M_SUPPLIER.SUP_CD = S_ORDER.ACC_CD
        INNER JOIN M_SUPPLIER_LANG
        ON
                M_SUPPLIER_LANG.COMPANY_CD = M_SUPPLIER.COMPANY_CD
            AND M_SUPPLIER_LANG.SUP_CD = M_SUPPLIER.SUP_CD
            AND M_SUPPLIER_LANG.LANGUAGE_IND = M_SUPPLIER.BASE_LANGUAGE_IND
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_A
            ON   S_ORDER.ATTACH_FILE_SEQ1 = S_ORDER_ATTACH_A.ATTACH_FILE_SEQ
                 AND S_ORDER_ATTACH_A.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_B
            ON   S_ORDER.ATTACH_FILE_SEQ2 = S_ORDER_ATTACH_B.ATTACH_FILE_SEQ
                 AND S_ORDER_ATTACH_B.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_C
            ON   S_ORDER.ATTACH_FILE_SEQ3 = S_ORDER_ATTACH_C.ATTACH_FILE_SEQ
                 AND S_ORDER_ATTACH_C.DELETE_FLG = '0'
        WHERE
            S_NEW_DLV_EST.DLV_EST_SEQ = #{delivMngSeq}
    </select>
    <!--
                ②　選択された納期管理シーケンス番号で、新着納期確認情報を取得
    -->
    <select id="listDelivDetail" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify"
         resultType="fw.domain.sp.dlv.DelivInfoList">
        SELECT
            DELIV_VERSION AS "historyNo.historyNo",
            INQ_DATE AS "delivCheckDate.dateOfymd",
            RESP_LIMIT_DATE AS "delivRcvLimit.dateOfymd",
            INQ_COMMENT AS "checkDetail"
        FROM S_NEW_DLV_EST
        WHERE
            DLV_EST_SEQ = #{delivMngSeq}

    </select>
    <!-- 選択された納期管理シーケンス番号で、新着納期確認の明細部を取得 -->
    <select id="listDelivInfoItemList" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify"
         resultType="fw.domain.sp.dlv.DelivInfoItem">
        SELECT
            S_NEW_DLV_EST_DTL.EST_DELIV_DATE AS "checkDelivDate.dateOfymd",
            S_NEW_DLV_EST_DTL.EST_DELIV_VOL AS "checkAmount.vol"
        FROM S_NEW_DLV_EST
        INNER　JOIN S_NEW_DLV_EST_DTL
        ON   S_NEW_DLV_EST.ACC_CD = S_NEW_DLV_EST_DTL.ACC_CD
               AND  S_NEW_DLV_EST.CUST_CD = S_NEW_DLV_EST_DTL.CUST_CD
               AND  S_NEW_DLV_EST.ORDER_NO = S_NEW_DLV_EST_DTL.ORDER_NO
               AND  S_NEW_DLV_EST.DELIV_VERSION = S_NEW_DLV_EST_DTL.DELIV_VERSION
               AND  S_NEW_DLV_EST_DTL.DELETE_FLG ='0'
        WHERE
            S_NEW_DLV_EST.DLV_EST_SEQ = #{delivMngSeq}
          ORDER BY S_NEW_DLV_EST_DTL.DELIV_LINE_NO
    </select>

    <!-- ６－１．SQL仕様 (納期回答詳細ボタンから) -->
    <select id="searchDetailforDelivResp" resultMap="OrderBaseInfo_Map">
      SELECT S_ORDER.ACC_CD AS "accCd"
           , S_ORDER.CUST_CD AS "custCd"
           , S_ORDER.ORDER_NO AS "orderNo.orderNo"
           , S_ORDER.APL_NO AS "quotReqNo"
           , S_ORDER.ORDER_VERSION AS "historyNo.historyNo"
           , S_ORDER.INFO_CD AS "infoCd"
           , S_ORDER.TITLE_NAME AS "titleName.titleName"
           , S_ORDER.REQ_TYPE_IND AS "reqInd.reqInd"
           , S_ORDER.UNIT_PRICE_IND AS "unitPriceInd"
           , M_SUPPLIER_LANG.SUP_ABBR_NAME AS "accAbbrName"
           , S_ORDER.PRICE_UNDEC_REASON AS "priceUndecidedReason"
           , S_ORDER.PRICE_DEC_DATE AS "priceDecideDate.dateOfymd"
           , S_ORDER.ORDER_FIRST_DATE AS "orderInfo.orderDate.dateOfymd"
           , S_ORDER.DELIVERY_DATE AS "orderDeliv.dateOfymd"
           , S_ORDER.BUYER_COMPANY_CD AS "custInfo.custCompany.code"
           , S_ORDER.BUYER_COMPANY_NAME AS "custInfo.custCompany.name"
           , S_ORDER.BUYER_SECTION_PLACE_NAME AS "BUYER_SECTION_PLACE_NAME"
           , S_ORDER.BUYER_SECTION_NAME AS "custInfo.custUser.sectionName"
           , S_ORDER.BUYER_USER_TEL_NO AS "BUYER_USER_TEL_NO"
           , S_ORDER.BUYER_USER_MAIL_ADDR
           , S_ORDER.BUYER_USER_NAME AS "custInfo.custUser.userName"
           , S_ORDER.REQ_SECTION_PLACE_NAME AS "requestUser.sectionPlaceName"
           , S_ORDER.REQ_SECTION_NAME AS "requestUser.sectionName"
           , S_ORDER.REQ_USER_NAME AS "requestUser.userName"
           , S_ORDER.REQ_TEL_NO AS "requestUser.telNo.telNo"
           , S_ORDER.REQ_USER_MAIL_ADDR
           , S_ORDER.FOR_SUPPLIER_COMMENT AS "custInfo.comment.comment"
           , S_ORDER.ITEM_NAME  AS "itemName"
           , S_ORDER.CUST_ITEM_CD AS "itemCd"
           , S_ORDER.KATASHIKI AS "katashiki"
           , S_ORDER.MANUFACT_CD AS "manufact.manufactCd"
           , S_ORDER.MANUFACT_NAME AS "manufact.manufactName"
           , S_ORDER.CURRENCY_CD AS "currencyCd"
           , S_ORDER.UNIT_PRICE AS "orderInfo.orderPrice.amount"
           , S_ORDER.ORDER_VOL AS "orderInfo.orderVol.vol"
           , S_ORDER.ORDER_CANCEL_VOL AS "orderCancelVol.vol"
           , S_ORDER.ORDER_AMOUNT AS "orderInfo.orderAmount.amount"
           , S_ORDER.ORDER_CANCEL_AMOUNT AS "orderCancelAmount.amount"
           , S_ORDER.REMAINING_VOL AS "orderInfo.remainingVol.vol"
           , S_ORDER.TAX_IND AS "orderInfo.taxInd"
           , S_ORDER.UNIT_NAME AS "orderInfo.unitName"
           , S_ORDER.DELIV_PLACE_ZIP_CD AS "DELIV_PLACE_ZIP"
           , S_ORDER.DELIV_PLACE_NAME AS "delivPlace.delivPlaceName"
           , S_ORDER.DELIV_PLACE_ADDRESS1 AS "DELIV_PLACE_ADDRESS1"
           , S_ORDER.DELIV_PLACE_ADDRESS2 AS "DELIV_PLACE_ADDRESS2"
           , S_ORDER.DELIV_PLACE_TEL_NO AS "DELIV_PLACE_TEL_NO"
           , S_ORDER.DEST_AREA AS "delivPlace.delivPlaceNameInb"
           , S_ORDER.ATTACH_FILE_SEQ1 AS "attachFileSeq1"
           , S_ORDER.ATTACH_FILE_SEQ2 AS "attachFileSeq2"
           , S_ORDER.ATTACH_FILE_SEQ3 AS "attachFileSeq3"
           , S_ORDER_ATTACH_A.ATTACH_FILE_NAME AS "attachFileName1"
           , S_ORDER_ATTACH_B.ATTACH_FILE_NAME AS "attachFileName2"
           , S_ORDER_ATTACH_C.ATTACH_FILE_NAME AS "attachFileName3"
        FROM S_ORDER
       INNER JOIN M_SUPPLIER
          ON(M_SUPPLIER.COMPANY_CD = S_ORDER.CUST_CD OR M_SUPPLIER.COMPANY_CD = 'ALL')
         AND M_SUPPLIER.SUP_CD = S_ORDER.ACC_CD
       INNER JOIN M_SUPPLIER_LANG
          ON M_SUPPLIER_LANG.COMPANY_CD = M_SUPPLIER.COMPANY_CD
         AND M_SUPPLIER_LANG.SUP_CD = M_SUPPLIER.SUP_CD
         AND M_SUPPLIER_LANG.LANGUAGE_IND = M_SUPPLIER.BASE_LANGUAGE_IND
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_A
          ON S_ORDER.ATTACH_FILE_SEQ1 = S_ORDER_ATTACH_A.ATTACH_FILE_SEQ
         AND S_ORDER_ATTACH_A.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_B
          ON S_ORDER.ATTACH_FILE_SEQ2 = S_ORDER_ATTACH_B.ATTACH_FILE_SEQ
         AND S_ORDER_ATTACH_B.DELETE_FLG = '0'
        LEFT JOIN S_ORDER_ATTACH S_ORDER_ATTACH_C
          ON S_ORDER.ATTACH_FILE_SEQ3 = S_ORDER_ATTACH_C.ATTACH_FILE_SEQ
         AND S_ORDER_ATTACH_C.DELETE_FLG = '0'
       WHERE S_ORDER.ORDER_SEQ = #{orderSeq}
    </select>

    <!-- ６－１．SQL仕様 (納期回答詳細ボタンから) SQL③-->
    <select id="delivInfoForList" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify"
        resultType="fw.domain.sp.dlv.DelivInfoItem">
      SELECT S_DLV_EST_DTL.INQ_RESP_DATE AS "checkDelivDate.dateOfymd"
           , S_DLV_EST_DTL.INQ_RESP_VOL AS "checkAmount.vol"
        FROM S_DLV_EST_DTL
       WHERE S_DLV_EST_DTL.CUST_CD = #{custCd}
         AND S_DLV_EST_DTL.ACC_CD = #{accCd}
         AND S_DLV_EST_DTL.ORDER_NO = #{orderNo}
         AND S_DLV_EST_DTL.DELIV_VERSION =
            (SELECT MAX(DELIV_VERSION)
               FROM S_DLV_EST_MNG
              WHERE S_DLV_EST_MNG.CUST_CD = #{custCd}
                AND S_DLV_EST_MNG.ACC_CD = #{accCd}
                AND S_DLV_EST_MNG.ORDER_NO = #{orderNo}
                AND S_DLV_EST_MNG.INQ_RESP_IND = '1'
                AND S_DLV_EST_MNG.ORDER_VERSION = #{orderVersion}
                AND S_DLV_EST_MNG.DELETE_FLG = '0')
         AND S_DLV_EST_DTL.INQ_RESP_IND = '1'
    ORDER BY S_DLV_EST_DTL.DELIV_LINE_NO
    </select>

    <!-- ６－１．SQL仕様 (納期回答詳細ボタンから) SQL②2)-->
    <select id="listDetailForDelivResp" parameterType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify"
         resultType="fw.domain.sp.dlv.DelivInfoList">
      SELECT S_DLV_EST_MNG.DELIV_VERSION AS "historyNo.historyNo"
           , S_DLV_EST_MNG.INQ_RESP_DATE AS "delivCheckDate.dateOfymd"
           , S_DLV_EST_MNG.RESP_LIMIT_DATE AS "delivRcvLimit.dateOfymd"
           , S_DLV_EST_MNG.INQ_RESP_COMMENT AS "checkDetail"
        FROM S_DLV_EST_MNG
       WHERE S_DLV_EST_MNG.CUST_CD = #{custCd}
         AND S_DLV_EST_MNG.ACC_CD = #{accCd}
         AND S_DLV_EST_MNG.ORDER_NO = #{orderNo}
         AND S_DLV_EST_MNG.ORDER_VERSION = #{orderVersion}
         AND S_DLV_EST_MNG.DELIV_VERSION =
            (SELECT MAX(DELIV_VERSION)
               FROM S_DLV_EST_MNG
              WHERE S_DLV_EST_MNG.CUST_CD = #{custCd}
                AND S_DLV_EST_MNG.ACC_CD = #{accCd}
                AND S_DLV_EST_MNG.ORDER_NO = #{orderNo}
                AND S_DLV_EST_MNG.ORDER_VERSION = #{orderVersion}
                AND S_DLV_EST_MNG.INQ_RESP_IND  = '1'
                AND S_DLV_EST_MNG.DELETE_FLG = '0')
         AND S_DLV_EST_MNG.INQ_RESP_IND='1'
    </select>
    <!-- ６－１．SQL仕様 (納期回答詳細ボタンから) SQL②1)-->
    <select id="getDelivMngIdentify" resultType="fw.domain.sp.dlv.dlvconfirm.DelivMngIdentify">
      SELECT CUST_CD AS "custCd"
           , ACC_CD AS "accCd"
           , ORDER_NO AS "orderNo"
           , ORDER_VERSION AS "orderVersion"
        FROM S_DLV_EST_MNG
       WHERE S_DLV_EST_MNG.DLV_EST_MNG_SEQ = #{dlvEstMngSeq}
    </select>

    <sql id="pageHeader">
       SELECT * FROM (
    </sql>
    <sql id="pageRoot">
        ) WHERE  ROWNUM &lt;=${@fw.common.util.PropertiesUtil@getLong("DOWNLOAD_MAXCNT")}
    </sql>
</mapper>
